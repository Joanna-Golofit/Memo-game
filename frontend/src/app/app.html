<div class="memory-game">
  <!-- KOMUNIKAT COUNTDOWN - OVERLAY NAD TYTUÅEM -->
  @if (gamePhase() === 'preview') {
    <div class="preview-message">
      <div class="countdown-bubble">
        â° ZapamiÄ™taj karty: <strong>{{ previewTimeLeft() }}s</strong>
      </div>
    </div>
  }

  <!-- NagÅ‚Ã³wek gry -->
  <header class="game-header">
    <h1 class="game-title">{{ title() }}</h1>
  </header>

  <!-- GÅ‚Ã³wna sekcja gry -->
  <main class="game-main">
    <!-- Panel gracza po lewej -->
    <div class="player-panel left-player" [class.active]="currentPlayer() === 0 && gamePhase() === 'playing'">
      <!-- EDYCJA IMIENIA GRACZA 1 -->
      @if (isEditingPlayer1()) {
        <div class="name-editor">
          <input 
            type="text" 
            class="name-input"
            [value]="player1Name()"
            (blur)="savePlayer1Name($event)"
            (keyup.enter)="savePlayer1Name($event)"
            (keyup.escape)="cancelEditingPlayer1()"
            maxlength="12"
            autofocus>
        </div>
      } @else {
        <div class="player-name" (click)="startEditingPlayer1()">
          {{player1Name()}} 
          <span class="edit-icon">âœï¸</span>
        </div>
      }
      
      <div class="score">â­ {{ player1Score() }}</div>
    </div>

    <!-- Plansza gry -->
    <div class="game-board">
      @for (card of cards(); track card.position) {
        <div 
          class="card"
          [class.flipped]="card.isFlipped || gamePhase() === 'preview'"
          [class.matched]="card.isMatched"
          (click)="onCardClick(card)">
          
          <div class="card-back">
            <span class="card-text">?</span>
          </div>
          
          <div class="card-front">
            <img 
              [src]="getImageUrl(card)" 
              [alt]="card.name"
              class="card-image"
              loading="lazy">
            <span class="card-name">{{card.name}}</span>
          </div>
        </div>
      }
    </div>

    <!-- Panel gracza po prawej -->
    <div class="player-panel right-player" [class.active]="currentPlayer() === 1 && gamePhase() === 'playing'">
      <!-- EDYCJA IMIENIA GRACZA 2 -->
      @if (isEditingPlayer2()) {
        <div class="name-editor">
          <input 
            type="text" 
            class="name-input"
            [value]="player2Name()"
            (blur)="savePlayer2Name($event)"
            (keyup.enter)="savePlayer2Name($event)"
            (keyup.escape)="cancelEditingPlayer2()"
            maxlength="12"
            autofocus>
        </div>
      } @else {
        <div class="player-name" (click)="startEditingPlayer2()">
          {{player2Name()}} 
          <span class="edit-icon">âœï¸</span>
        </div>
      }
      
      <div class="score">ğŸ† {{ player2Score() }}</div>
    </div>
  </main>

  
  <!-- Przycisk restart -->
  <footer class="game-footer">
    <button 
    class="restart-btn"
    (click)="onRestartClick()"
    [class.pulse]="isGameFinished()"
    >
    <span *ngIf="isGameFinished()">ğŸ‰ Zagraj ponownie</span>
    <span *ngIf="!isGameFinished() && hasNoMatchedCards()">ğŸ”„ Nowe karty</span>
    <span *ngIf="!isGameFinished() && !hasNoMatchedCards()">ğŸ”„ Restart gry</span>
  </button>
  
  <!-- KATEGORIE POD PLANSZÄ„ -->
    <div class="category-selector">
      <h3>Wybierz kategoriÄ™:</h3>
      <div class="category-buttons">
        @for (category of availableCategories(); track category.id) {
          <button 
          class="category-btn"
          [class.active]="selectedCategory() === category.id"
          (click)="onCategoryChange(category.id)">
          <span class="category-icon">{{category.icon}}</span>
          <span class="category-name">{{category.name}}</span>
        </button>
      }
    </div>
  </div>
</footer>

  <!-- OVERLAY MESSAGES -->
  
  <!-- Komunikat o zwyciÄ™zcy -->
  @if (gamePhase() === 'finished') {
    <div class="overlay-message center-overlay">
      <div class="congratulations">
        <span *ngIf="player1Score() > player2Score()">ğŸ† Wygrywa {{player1Name()}}!</span>
        <span *ngIf="player2Score() > player1Score()">ğŸ† Wygrywa {{player2Name()}}!</span>
        <span *ngIf="player1Score() === player2Score()">ğŸ¤ Remis!</span>
      </div>
    </div>
  }

  <!-- Dialog potwierdzenia restartu -->
  @if (showRestartConfirm()) {
    <div class="overlay-message restart-overlay">
      <div class="restart-confirm">
        <p>Czy na pewno chcesz zaczÄ…Ä‡ nowÄ… grÄ™?</p>
        <div class="confirm-buttons">
          <button class="confirm-yes" (click)="confirmRestart()">Tak</button>
          <button class="confirm-no" (click)="cancelRestart()">Nie</button>
        </div>
      </div>
    </div>
  }
</div>